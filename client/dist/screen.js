var app=angular.module("leChef",["ngRoute","ngSanitize","ngAnimate","ngTouch","ngIOS9UIWebViewPatch","ngAria","ckeditor","firebase","720kb.socialshare","flow","angular-spinkit"]);app.config(["flowFactoryProvider",function(e){e.defaults={target:"/images/upload.php",permanentErrors:[500,501],maxChunkRetries:1,chunkRetryInterval:5e3,simultaneousUploads:1},e.on("catchAll",function(e){console.log("catchAll",arguments)})}]),app.run(["$rootScope","$location","$anchorScroll","$routeParams",function(e,r,t,n){e.$on("$routeChangeSuccess",function(e,o){r.hash(n.scrollTo),t()})}]),app.run(["$rootScope","$location",function(e,r){e.$on("$routeChangeError",function(e,t,n,o){"AUTH_REQUIRED"===o&&r.path("/auth")})}]),app.config(["$routeProvider","$compileProvider",function(e,r){r.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension):/),e.when("/",{templateUrl:"templates/recipes.html",controller:"RecipesController",resolve:{currentAuth:["Auth",function(e){return e.$waitForAuth()}]}}).when("/recipe/:id",{templateUrl:"templates/recipe.html",controller:"RecipeController",resolve:{currentAuth:["Auth",function(e){return e.$waitForAuth()}]}}).when("/editor/",{templateUrl:"templates/editor.html",controller:"EditorController",resolve:{currentAuth:["Auth",function(e){return e.$requireAuth()}]}}).when("/editor/:id",{templateUrl:"templates/editor.html",controller:"EditorController",resolve:{currentAuth:["Auth",function(e){return e.$requireAuth()}]}}).when("/auth",{templateUrl:"templates/auth.html",controller:"AuthController",resolve:{currentAuth:["Auth",function(e){return e.$waitForAuth()}]}}).when("/reset",{templateUrl:"templates/reset.html",controller:"AuthController",resolve:{currentAuth:["Auth",function(e){return e.$waitForAuth()}]}}).when("/new-password",{templateUrl:"templates/new-password.html",controller:"AuthController",resolve:{currentAuth:["Auth",function(e){return e.$waitForAuth()}]}}).otherwise({redirectTo:"/"})}]),app.controller("AuthController",["$scope","$routeParams","$location","$firebaseAuth","Auth",function(e,r,t,n,o){e.auth=o,e.auth.$onAuth(function(r){e.authData=r}),e.login=function(){e.message=null,e.error=null,o.$authWithPassword({email:e.email,password:e.password}).then(function(r){e.message="Loged in successfully as "+r.password.email})["catch"](function(r){e.error="Something went wrong! Please try again or reset password."}).then(function(){null!==e.error?t.path("/auth"):t.path("/")})},e.resetPassword=function(){e.message=null,e.error=null,o.$resetPassword({email:e.email}).then(function(r){null===e.error?e.message="Password reset email sent successfully. Check your inbox.":e.error="Error sending password reset email:"})},e.changePassword=function(){e.message=null,e.error=null,o.$changePassword({email:e.email,oldPassword:e.oldPassword,newPassword:e.newPassword}).then(function(r){null===e.error?e.message="Password changed successfully":e.error="Error changing password:"})}}]),app.controller("EditorController",["$scope","Recipes","$location","$routeParams","currentAuth",function(e,r,t,n,o,i){e.initRecipe=function(){"undefined"==typeof n.id?e.recipe={title:"",lead:"",preptime:"",cookingtime:"",totaltime:"",instructions:"",ingredients:[""],keywords:[""],slides:["/images/dummy-recipe.jpg"]}:e.recipes.$loaded().then(function(r){e.recipe=r.$getRecord(n.id)})},e.upload={},e.options={toolbar:[{items:["Bold","Italic","NumberedList","BulletedList","Link","Unlink"]}]},e.add=function(r){e.recipe[r].push("")},e.remove=function(r,t){e.recipe[r].splice(t,1)},e.addRecipe=function(){for(var n=0;n<e.upload.flow.files.length;n++)e.recipe.slides.push("/images/uploads/"+e.upload.flow.files[n].relativePath);e.recipe.createdOn=Date.now(),e.recipes=r,e.recipes.$add(e.recipe).then(function(){alert("Your recipe has been succefully saved!"),t.path("/")}),e.initRecipe()},e.cancelEditRecipe=function(){alert("If you wish jellyfish!"),e.recipe.$id?t.path("/recipe/"+e.recipe.$id):t.path("/")},e.editRecipe=function(){for(var r=0;r<e.upload.flow.files.length;r++)e.recipe.slides.push("/images/uploads/"+e.upload.flow.files[r].relativePath);e.recipes.$save(e.recipe).then(function(){alert("Your recipe has been succefully updated!"),t.path("/recipe/"+e.recipe.$id)})},e.deleteRecipe=function(){window.confirm("Do you really want to delete your recipe?")&&e.recipes.$remove(e.recipe).then(function(){alert("Your recipe has been succefully deleted!"),t.path("/")})},e.initRecipe()}]),app.controller("RecipeController",["$scope","$location","$routeParams","$compile","Recipes",function(e,r,t,n,o){e.addReview=function(){e.recipe.reviews.push(e.recipe.review),e.recipe.review.createdOn=Date.now(),e.recipe.review={},e.recipes.$save(e.recipe).then(function(){alert("Your review has been succefully sent!"),r.path("/recipe/"+e.recipe.$id)})},e.recipes.$loaded().then(function(r){e.recipe=r.$getRecord(t.id),e.html=e.recipe.instructions,"undefined"==typeof e.recipe.reviews&&(e.recipe.reviews=[{}]),e.calculateAverage=function(r){var t=0;if(e.recipe.reviews.length>1){for(var n=1;n<e.recipe.reviews.length;n++)t+=parseInt(e.recipe.reviews[n].stars,10);var o=t/(e.recipe.reviews.length-1),i=Math.round(o);return{average:i,markedStars:new Array(i)}}return t}}),e.direction="left",e.currentIndex=0,e.setCurrentSlideIndex=function(r){e.currentIndex=r},e.isCurrentSlideIndex=function(r){return e.currentIndex===r},e.prevSlide=function(){e.currentIndex=e.currentIndex<e.recipe.slides.length-1?++e.currentIndex:0},e.nextSlide=function(){e.currentIndex=e.currentIndex>0?--e.currentIndex:e.recipe.slides.length-1},e.goToEditor=function(){r.path("/editor/"+e.recipe.$id)}}]),app.controller("RecipesController",["$scope","$location","Recipes","$http",function(e,r,t,n){e.loading=!0,n.get("https://fiery-inferno-8595.firebaseio.com/recipes/").success(function(e){})["catch"](function(e){})["finally"](function(){e.loading=!1}),e.recipes=t,e.currentPath=window.location}]),app.directive("eventFocus",function(e){return function(r,t,n){t.on(n.eventFocus,function(){e(n.eventFocusId)}),r.$on("$destroy",function(){element.off(n.eventFocus)})}}),app.directive("imageSlider",function(){return{restrict:"E",templateUrl:"templates/slider.html"}}),app.factory("Auth",["$firebaseAuth",function(e){var r=new Firebase("https://fiery-inferno-8595.firebaseio.com/recipes");return e(r)}]),app.factory("Recipes",["$firebaseArray",function(e){var r=new Firebase("https://fiery-inferno-8595.firebaseio.com/recipes/");return e(r)}]),app.factory("focus",function(e,r){return function(t){e(function(){var e=r.document.getElementById(t);e&&e.focus()})}});